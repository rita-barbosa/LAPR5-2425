@startuml
'https://plantuml.com/sequence-diagram

title "US 5.1.16. Process View (Level 3)"

autonumber

participant "route:\nOperationRequestRoute" as ROUTE
participant "dto:\nOperationRequestDTO" as DTO
participant "controller:\nOperationRequestController" as CTRL

participant "service:\nStaffService" as STAFFServ
participant "repository:\nStaffRepository" as STAFFRepo
participant "dto:\nStaffDTO" as StaffDTO
participant "service:\nAuthenticationService" as AUTHServ

participant "service:\nOperationRequestService" as SER
participant "repository:\nOperationRequestRepository" as REPO
participant "domain:\nOperationRequest" as OPREQ

[o-> ROUTE : POST(json)
activate ROUTE

ROUTE -> DTO** : create(json)

ROUTE -> CTRL : createOperationRequest(request,response,next)
activate CTRL

CTRL -> STAFFServ : findCurrentSessionDoctor()
activate STAFFServ

STAFFServ -> AUTHServ : getSessionUser()
activate AUTHServ

AUTHServ --> STAFFServ : user
deactivate AUTHServ

STAFFServ -> STAFFRepo : getDoctorByUser(user)
activate STAFFRepo

STAFFRepo --> STAFFServ : doctor
deactivate STAFFRepo

STAFFServ --> StaffDTO ** : toDTO(doctor)

STAFFServ --> CTRL : doctorDTO
deactivate STAFFServ

CTRL -> SER : createOperationRequest(doctorID,patientID,operationType,priority,deadline)
activate SER

SER -> OPREQ** : createOperationRequest(doctorID, patientID,operationType,priority,deadline)

SER -> REPO : save(operationRequest)
activate REPO
deactivate REPO

SER --> CTRL : answer
deactivate SER

CTRL --> ROUTE : answer
deactivate CTRL

 <-- ROUTE : answer

@enduml