@startuml

title "US 6.1.3 - Process View [Level 3 | Visualization]"

autonumber
actor "Backoffice User" as USER
participant "HospitalFloorSimulation" as UPP <<component>>
participant "AppointmentService" as PS <<service>>

USER -> UPP : wants to see hospital floor simulation
activate UPP

UPP -> PS : getTodaySchedule()
activate PS

PS ->o] : GET: api/appointment/GetTodaySchedule

PS <--o] : Ok(schedule)

PS -> PS : processData(schedule)
activate PS
deactivate PS

PS --> UPP: scheduleData
deactivate PS

UPP -> UPP : initialization of sub elements\n (walls, surgical beds,\n doors, floor, light, camera)
activate UPP
deactivate UPP

UPP --> USER: shows 3D simulation canvas within webpage
deactivate UPP


USER -> UPP : changes the time in the simulation
note left
When  the time changes
in the simulation's UI,
onChange() is called
end note
activate UPP

UPP -> UPP : onChange(time => timeCallback(time, roomsSchedule))
activate UPP
note left
roomsSchedule is a map with
[roomID][AppointmentsList]
end note

loop for each room appointment entry
UPP -> UPP : isRoomOccupied(time)
activate UPP
alt room is occupied

UPP -> UPP : addPatientToRoom(roomID)
note right
The component knows to
what positions the surgical
tables in rooms are
end note

UPP -> UPP : updateTooltip(roomID, appointment)
end alt

UPP --> UPP
deactivate UPP
|||

end alt
UPP --> UPP :
deactivate UPP

UPP --> USER : shows the room with patients\n according to the time
deactivate UPP


USER -> UPP : clicks on a surgical bed
activate UPP

UPP -> UPP : getRoomFromBedRaycasting()

UPP -> UPP : isRoomOccupied(time)
alt is occupied

UPP -> UPP : showTooltip(roomID, appointment)
else

UPP -> UPP : showTooltip(roomID, unidentified)
end alt

UPP --> USER: shows tooltip with appointment information
deactivate UPP

@enduml